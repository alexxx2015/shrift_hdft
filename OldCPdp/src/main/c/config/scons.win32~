# config/win32 scons configuration
import os
Import('tmpConfig')

DefaultEnvironment(tools=[])
#env=Environment(tools=['mingw','javac','jar','rmic'],
env=Environment(CC='/home/rd/w64/local32/bin/i686-w64-mingw32-gcc',
                PEFCONFIG=tmpConfig['PEFCONFIG'], 
                PEFBASE=tmpConfig['PEFBASE'], 
                PEFBUILD=tmpConfig['PEFBUILD'], 
                PEFincludes=tmpConfig['PEFincludes'])

# Java JDK include path
#java="C:\\Program Files\\Java\\jdk1.6.0_33\\include"
#java="C:\\Program Files\\Java\\jdk1.7.0_45\\include"
java=os.path.join(env['PEFBASE'], "..", "resources","win32","jdk","include")

#env.Append(CCFLAGS = " -fPIC ")
env['STATIC_AND_SHARED_OBJECTS_ARE_THE_SAME']=1

env.Append(CPPPATH=[java])
env.Append(CPPPATH=[os.path.join(java, "win32")])

env.Append(LIBPATH=[os.path.join(java, "..", "jre","bin","server")])
#env.Append(LIBPATH=["C:\\Program Files (x86)\\Java\\jre7\\bin\\client"])

env.Append(LIBPATH=[os.path.join(env['PEFBASE'], "..", "resources", "win32", "glib2", "lib"),
                    os.path.join(env['PEFBASE'], "..", "resources", "win32", "regex", "lib"),
                    os.path.join(env['PEFBASE'], "..", "..", "..") # for jvm -> todo
                   ])

#env.Append(LIBPATH=[os.path.join(env['PEFBASE'], "..", "resources", "win64", "glib2", "lib"),
#                    os.path.join(env['PEFBASE'], "..", "..", "..") # for jvm -> todo
#                   ])
                   

env.Append(PEFpdpjni=' -DPDP_JNI -DGLIB_STATIC_COMPILATION -DGOBJECT_STATIC_COMPILATION -D_JNI_IMPLEMENTATION_ -DLIBXML_STATIC -Wl,--kill-at -shared ')
#env.Append(PEFpdpjni=' -DPDP_JNI -D_JNI_IMPLEMENTATION_ -DLIBXML_STATIC -Wl,--kill-at -shared ')

# glib,xml need to be added manually to ensure libintl, libiconv is linked afterwards
#env.Prepend(LIBS=['glib-2.0','iconv'])
# xml2 muss hier sein, ansonsten wird es automatisch via -lxml2 angehangen ==> shared lib 
# env['LIBS'] wird NICHT fuer PDP verwendet, nur fuer test-apps
env.Prepend(LIBS=['glib-2.0','xml2'])
env.Append(LIBS=['ole32'])
env.Append(LIBS=['ws2_32','wsock32'])

#env.Append(LIBS=['regex'])
# linking to static regex.a not sufficient; still libgnurx required
env.Append(LibRegexStatic=File(os.path.join(env['PEFBASE'], "..", "resources","win32","regex","lib","libregex.a")))
env.Append(LIBS=[env['LibRegexStatic']])

#env.Append(LibXML2Static =File(os.path.join(env['PEFBASE'], "..", "resources","win32","lib","libxml2.a")))
env.Append(LibXML2Static =File(os.path.join(env['PEFBASE'], "..", "resources","win32","xml2-test","libxml2-2.7.8.win32","lib","libxml2_a.lib")))
env.Append(LibZStatic    =File(os.path.join(env['PEFBASE'], "..", "resources","win32","lib","libz.a")))
env.Append(LibIntlStatic =File(os.path.join(env['PEFBASE'], "..", "resources","win32","lib","libintl.a")))
env.Append(LibIConvStatic=File(os.path.join(env['PEFBASE'], "..", "resources","win32","lib","libiconv.a")))
env.Append(LibGLibStatic=File(os.path.join(env['PEFBASE'], "..", "resources","win32","glib2","lib","libglib-2.0.a")))

#env.Append(LibXML2Static =File(os.path.join(env['PEFBASE'], "..", "resources","win64","libxml2","libxml","lib","libxml2.a")))
#env.Append(LibZStatic    =File(os.path.join(env['PEFBASE'], "..", "resources","win64","zlib","lib","libz.a")))
#env.Append(LibIntlStatic =File(os.path.join(env['PEFBASE'], "..", "resources","win64","static","gettext","lib","libintl.a")))
#env.Append(LibIConvStatic=File(os.path.join(env['PEFBASE'], "..", "resources","win64","static","libiconv","lib","libiconv.a")))
#env.Append(LibGLibStatic=File(os.path.join(env['PEFBASE'], "..", "resources","win64","static","glib2","lib","libglib-2.0.a")))
#env.Append(LibWinPThreadStatic=File(os.path.join(env['PEFBASE'], "..", "resources","win64","lib","libwinpthread.a")))
#env.Append(LibPDPStatic=File(os.path.join(env['PEFBASE'],'..','..','..','bin','windows','components','pdp','libpdp.a')))

#env.Append(LIBS=[env['LibIntlStatic'], env['LibIConvStatic']])
env.Append(LIBS=[env['LibIntlStatic'], env['LibXML2Static'], env['LibZStatic']])

env.Append(CPPPATH=[os.path.join(env['PEFBASE'], "..", "resources", "win32", "libxml2"),
                    os.path.join(env['PEFBASE'], "..", "resources", "win64", "libiconv","include"),
                    os.path.join(env['PEFBASE'], "..", "resources", "win32", "glib2", "include","glib-2.0"),
                    os.path.join(env['PEFBASE'], "..", "resources", "win32", "glib2", "lib","glib-2.0","include"),
                    os.path.join(env['PEFBASE'], "..", "resources", "win32", "regex", "include")
                   ]
          )

#env.Append(CPPPATH=[os.path.join(env['PEFBASE'], "..", "resources", "win64", "libxml2","libxml","include","libxml2"),
#                    os.path.join(env['PEFBASE'], "..", "resources", "win64", "libiconv","include"),
#                    os.path.join(env['PEFBASE'], "..", "resources", "win64", "glib2", "include","glib-2.0"),
#                    os.path.join(env['PEFBASE'], "..", "resources", "win64", "glib2", "lib","glib-2.0","include"),
#                    os.path.join(env['PEFBASE'], "..", "resources", "win32", "regex", "include")					
#                   ]
#          )
		  
#######################################################################
# module configuration
env['PEFCONFIG']['pdpjni']      = True
env['PEFCONFIG']['socketUtils'] = False

env['PEFCONFIG']['systracePEP'] = False
env['PEFCONFIG']['shellWrapper']= False
env['PEFCONFIG']['dataCont']    = False

Return('env')
